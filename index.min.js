import t from"axios";import e from"jschardet";async function r(r,i){const n={url:r,status:!0,errorMsg:"",iconUrl:"",title:"",description:""};if(!r)return n.status=!1,n.errorMsg="no url",n;try{const{origin:c,protocol:s}=new URL(r),o=await t.get(r,{headers:{"Content-Type":"text/html;charset=utf-8"},responseType:"arraybuffer",...i}),a=Buffer.from(o.data,"binary"),u=e.detect(a).encoding||"utf-8";let l=new TextDecoder(u).decode(o.data);n.iconUrl=function(t,e,r){r=r.replace(":","");const i=/href=['"]((.|\s)*?)['"]/i,n=t.match(/<link(.|\s)*?\/?>/gi);if(Array.isArray(n))for(const t of n)if(t.includes('rel="icon"')||t.includes("rel=icon")||t.includes("rel='icon'")||t.includes('rel="shortcut icon"')||t.includes("rel='shortcut icon'")||t.includes("rel='icon shortcut'")||t.includes('rel="icon shortcut"')||t.includes('rel="apple-touch-icon-precomposed"')||t.includes("rel='apple-touch-icon-precomposed'")||t.includes('rel="apple-touch-icon"')||t.includes("rel='apple-touch-icon'")){const n=t.match(i);if(n&&n[1]){let t=n[1];if(t.startsWith("data:image"))return t;if(t.startsWith("://"))return r+t;if(t.startsWith("//"))return r+":"+t;if(t.includes("://"))return t;if(t.startsWith("/"))return e+t;if(!t.startsWith("/"))return e+"/"+t;break}}return""}(l,c,s).trim(),n.title=function(t){const e=t.match(/<title>([^<]*)?<\/title>/i);return e&&e[1]||""}(l).trim(),n.description=function(t){let e="";const r=/content=['"]((.|\s)*?)['"]/i,i=t.match(/<meta(.|\s)*?\/?>/gi);if(Array.isArray(i))for(const t of i)if(t.includes('name="description"')||t.includes("name=description")||t.includes("name='description'")){const i=t.match(r);if(i&&i[1]){e=i[1];break}}return e}(l).trim()}catch(t){n.errorMsg=t.message,n.status=!1}return n}export{r as default};
