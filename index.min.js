import t from"axios";import r from"jschardet";import e from"node:path";async function i(i,n){const c={url:i,status:!0,errorMsg:"",iconUrl:"",title:"",description:""};if(!i)return c.status=!1,c.errorMsg="no url",c;try{const{origin:o,protocol:s}=new URL(i),a=await t.get(i,{headers:{"Content-Type":"text/html;charset=utf-8"},responseType:"arraybuffer",...n}),u=Buffer.from(a.data,"binary"),l=r.detect(u).encoding||"utf-8";let d=new TextDecoder(l).decode(a.data);c.iconUrl=function(t,r,i){i=i.replace(":","");const n=/href=['"]((.|\s)*?)['"]/i,c=t.match(/<link(.|\s)*?\/?>/gi);if(Array.isArray(c))for(const t of c)if(t.includes('rel="icon"')||t.includes("rel=icon")||t.includes("rel='icon'")||t.includes('rel="shortcut icon"')||t.includes("rel='shortcut icon'")||t.includes("rel='icon shortcut'")||t.includes('rel="icon shortcut"')||t.includes('rel="apple-touch-icon-precomposed"')||t.includes("rel='apple-touch-icon-precomposed'")||t.includes('rel="apple-touch-icon"')||t.includes("rel='apple-touch-icon'")){const c=t.match(n);if(c&&c[1]){let t=c[1];if(t.startsWith("data:image"))return t;if(t.startsWith("://"))return i+t;if(t.startsWith("//"))return i+":"+t;if(t.includes("://"))return t;if(t.startsWith("/"))return r+t;if(!t.startsWith("/"))return e.join(r,t);break}}return""}(d,o,s).trim(),c.title=function(t){const r=t.match(/<title>([^<]*)?<\/title>/i);return r&&r[1]||""}(d).trim(),c.description=function(t){let r="";const e=/content=['"]((.|\s)*?)['"]/i,i=t.match(/<meta(.|\s)*?\/?>/gi);if(Array.isArray(i))for(const t of i)if(t.includes('name="description"')||t.includes("name=description")||t.includes("name='description'")){const i=t.match(e);if(i&&i[1]){r=i[1];break}}return r}(d).trim()}catch(t){c.errorMsg=t.message,c.status=!1}return c}export{i as default};
