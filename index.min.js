import t from"axios";async function e(e,r){const i={url:e,status:!0,errorMsg:"",iconUrl:"",title:"",description:""};if(!e)return i;try{const{origin:n,protocol:c}=new URL(e),s=await t.get(n,{headers:{"Content-Type":"text/html;charset=utf-8"},responseType:"arraybuffer",...r}),o=(s.headers["content-type"]||"").toLowerCase(),l=o.includes("gbk")||o.includes("gb2312");let a=new TextDecoder(l?"gbk":"utf-8").decode(s.data);i.iconUrl=function(t,e,r){r=r.replace(":","");const i=/<link(.|\s)*?\/?>/gi,n=/href="((.|\s)*?)"/i;let c;try{c=t.match(i)}catch(t){console.log("getIconUrl",t.message)}if(Array.isArray(c))for(const t of c)if(t.includes('rel="icon"')||t.includes("rel=icon")||t.includes("rel='icon'")||t.includes('rel="shortcut icon"')||t.includes("rel='shortcut icon'")||t.includes("rel='icon shortcut'")||t.includes('rel="icon shortcut"')||t.includes('rel="apple-touch-icon-precomposed"')||t.includes("rel='apple-touch-icon-precomposed'")||t.includes('rel="apple-touch-icon"')||t.includes("rel='apple-touch-icon'")){const i=t.match(n);if(i&&i[1]){let t=i[1];if(t.startsWith("data:image"))return t;if(t.startsWith("://"))return r+t;if(t.startsWith("//"))return r+":"+t;if(t.includes("://"))return t;if(t.startsWith("/"))return e+t;if(!t.startsWith("/"))return e+"/"+t;break}}return""}(a,n,c).trim(),i.title=function(t){const e=t.match(/<title>([^<]*)?<\/title>/i);let r="";return e&&e[1]&&(r=e[1]),r}(a).trim(),i.description=function(t){let e="";const r=/<meta(.|\s)*?\/?>/gi,i=/content="((.|\s)*?)"/i;let n;try{n=t.match(r)}catch(t){console.log("getDescriptionï¼š",t.message)}if(Array.isArray(n))for(const t of n)if(t.includes('name="description"')||t.includes("name=description")||t.includes("name='description'")){const r=t.match(i);if(r&&r[1]){e=r[1];break}}return e}(a).trim()}catch(t){i.errorMsg=t.message,i.status=!1}return i}export{e as default};
